<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Particle Drawing</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <script>
    let points = []; // Array de puntos que representa las líneas de la imagen
    let particles = []; // Array de partículas
    let img; // Imagen a cargar

    function preload() {
      // Cargar la imagen
      img = loadImage('../data/images/benedetti.png');
    }

    function setup() {
      createCanvas(800, 800);
      img.loadPixels();
      // Obtener los puntos negros de la imagen
      for (let y = 0; y < img.height; y++) {
        for (let x = 0; x < img.width; x++) {
          let index = (x + y * img.width) * 4;
          let r = img.pixels[index];
          let g = img.pixels[index + 1];
          let b = img.pixels[index + 2];
          if (r < 50 && g < 50 && b < 50) { // Ajustar el umbral según sea necesario
            points.push(createVector(x, y));
          }
        }
      }
      // Inicializar partículas
      for (let i = 0; i < 100; i++) {
        particles.push(new Particle(random(width), random(height)));
      }
    }

    function draw() {
      background(255);
      for (let particle of particles) {
        particle.follow(points);
        particle.update();
        particle.show();
      }
    }

    // Clase Partícula
    class Particle {
      constructor(x, y) {
        this.pos = createVector(x, y);
        this.vel = p5.Vector.random2D();
        this.acc = createVector(0, 0);
        this.maxSpeed = 2;
      }

      follow(points) {
        let closest = null;
        let record = Infinity;
        points.shuffle;
        for (let pt of points) {
          let d = dist(this.pos.x, this.pos.y, pt.x, pt.y);
          if (d < record) {
            record = d;
            closest = pt;
          }
        }
        if (closest != null) {
          let desired = p5.Vector.sub(closest, this.pos);
          desired.setMag(this.maxSpeed);
          let steer = p5.Vector.sub(desired, this.vel);
          steer.limit(0.1);
          this.applyForce(steer);
        }
      }

      applyForce(force) {
        this.acc.add(force);
      }

      update() {
        this.vel.add(this.acc);
        this.pos.add(this.vel);
        this.acc.mult(0);
      }

      show() {
        // Obtener el color del píxel en la posición actual de la partícula
        let col = img.get(floor(this.pos.x), floor(this.pos.y));
        stroke(col);
        strokeWeight(1);
        point(this.pos.x, this.pos.y);
      }
    }
  </script>
</head>
<body>
</body>
</html>
